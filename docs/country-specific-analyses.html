<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Country-specific analyses | Supervised Classification with Google Earth Engine</title>
  <meta name="description" content="Chapter 5 Country-specific analyses | Supervised Classification with Google Earth Engine" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Country-specific analyses | Supervised Classification with Google Earth Engine" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Country-specific analyses | Supervised Classification with Google Earth Engine" />
  
  
  

<meta name="author" content="Celio Sousa" />


<meta name="date" content="2021-12-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="post-classification-processing.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Classification Tutorial</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction and overview</a></li>
<li class="chapter" data-level="2" data-path="auxiliary-functions.html"><a href="auxiliary-functions.html"><i class="fa fa-check"></i><b>2</b> Auxiliary functions</a>
<ul>
<li class="chapter" data-level="2.1" data-path="auxiliary-functions.html"><a href="auxiliary-functions.html#cloud-and-cloud-shadow-masking"><i class="fa fa-check"></i><b>2.1</b> Cloud and cloud shadow masking</a></li>
<li class="chapter" data-level="2.2" data-path="auxiliary-functions.html"><a href="auxiliary-functions.html#spectral-indices"><i class="fa fa-check"></i><b>2.2</b> Spectral indices</a></li>
<li class="chapter" data-level="2.3" data-path="auxiliary-functions.html"><a href="auxiliary-functions.html#compositing"><i class="fa fa-check"></i><b>2.3</b> Compositing</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="supervised-classification-of-landsat-8-oli-imagery.html"><a href="supervised-classification-of-landsat-8-oli-imagery.html"><i class="fa fa-check"></i><b>3</b> Supervised classification of Landsat 8 OLI imagery</a>
<ul>
<li class="chapter" data-level="3.1" data-path="supervised-classification-of-landsat-8-oli-imagery.html"><a href="supervised-classification-of-landsat-8-oli-imagery.html#example-1-land-cover-classification-of-greater-cairo-and-giza-area-egypt---year-2020"><i class="fa fa-check"></i><b>3.1</b> Example 1: Land cover classification of Greater Cairo and Giza area, Egypt - Year 2020</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="supervised-classification-of-landsat-8-oli-imagery.html"><a href="supervised-classification-of-landsat-8-oli-imagery.html#temporal-and-spatial-parameters-for-compositing"><i class="fa fa-check"></i><b>3.1.1</b> Temporal and spatial parameters for compositing</a></li>
<li class="chapter" data-level="3.1.2" data-path="supervised-classification-of-landsat-8-oli-imagery.html"><a href="supervised-classification-of-landsat-8-oli-imagery.html#landsat-8-pre-classification-steps"><i class="fa fa-check"></i><b>3.1.2</b> Landsat 8 Pre-classification steps</a></li>
<li class="chapter" data-level="3.1.3" data-path="supervised-classification-of-landsat-8-oli-imagery.html"><a href="supervised-classification-of-landsat-8-oli-imagery.html#supervised-classification-with-random-forest"><i class="fa fa-check"></i><b>3.1.3</b> Supervised Classification with Random Forest</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="supervised-classification-of-landsat-8-oli-imagery.html"><a href="supervised-classification-of-landsat-8-oli-imagery.html#example-2-2000---2020-map-to-map-change-of-greater-cairo-and-giza-area-egypt"><i class="fa fa-check"></i><b>3.2</b> Example 2: 2000 - 2020 Map-to-Map change of greater Cairo and Giza area, Egypt</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="post-classification-processing.html"><a href="post-classification-processing.html"><i class="fa fa-check"></i><b>4</b> Post-classification processing</a>
<ul>
<li class="chapter" data-level="4.1" data-path="post-classification-processing.html"><a href="post-classification-processing.html#re-classification"><i class="fa fa-check"></i><b>4.1</b> Re-classification</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="post-classification-processing.html"><a href="post-classification-processing.html#scenario-1"><i class="fa fa-check"></i><b>4.1.1</b> Scenario 1</a></li>
<li class="chapter" data-level="4.1.2" data-path="post-classification-processing.html"><a href="post-classification-processing.html#scenario-2"><i class="fa fa-check"></i><b>4.1.2</b> Scenario 2</a></li>
<li class="chapter" data-level="4.1.3" data-path="post-classification-processing.html"><a href="post-classification-processing.html#scenario-3"><i class="fa fa-check"></i><b>4.1.3</b> Scenario 3</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="post-classification-processing.html"><a href="post-classification-processing.html#map-spatial-smoothing"><i class="fa fa-check"></i><b>4.2</b> Map spatial smoothing</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="country-specific-analyses.html"><a href="country-specific-analyses.html"><i class="fa fa-check"></i><b>5</b> Country-specific analyses</a>
<ul>
<li class="chapter" data-level="5.1" data-path="country-specific-analyses.html"><a href="country-specific-analyses.html#mangrove-mapping-in-guinea---west-africa"><i class="fa fa-check"></i><b>5.1</b> Mangrove mapping in Guinea - West Africa</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="country-specific-analyses.html"><a href="country-specific-analyses.html#masking"><i class="fa fa-check"></i><b>5.1.1</b> Masking</a></li>
<li class="chapter" data-level="5.1.2" data-path="country-specific-analyses.html"><a href="country-specific-analyses.html#landsat-8-image-collection-and-cloud-free-mosaic"><i class="fa fa-check"></i><b>5.1.2</b> Landsat 8 Image Collection and Cloud-free Mosaic</a></li>
<li class="chapter" data-level="5.1.3" data-path="country-specific-analyses.html"><a href="country-specific-analyses.html#supervised-classification-with-random-forest-1"><i class="fa fa-check"></i><b>5.1.3</b> Supervised Classification with Random Forest</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Supervised Classification with Google Earth Engine</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="country-specific-analyses" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> Country-specific analyses</h1>
<p>In this chapter we will explore examples of class-specific classification using previously used functions as well as useful land cover classification-based analysis.</p>
<p>Objectives:</p>
<ul>
<li>To classify a cloud-free composite mosaic of Landsat 8 scenes for single class mapping in countries of interest in West Africa;</li>
<li>To introduce the use of other datasets in the classification workflow.</li>
</ul>
<div id="mangrove-mapping-in-guinea---west-africa" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Mangrove mapping in Guinea - West Africa</h2>
<p>In this example, we will use the codes from the previous chapters and adapt portions of them for mangrove mapping in Guinea, in West Africa. We will also introduce the use of other datasets for masking and sample selection to assist in the classification workflow.</p>
<p>Start by <a href="https://code.earthengine.google.com/" target="_blank">opening a new code editor page</a> and
by defining the spatial and temporal parameters of the composite you wish to classify, just like the other examples. For the temporal parameters, let’s use an annual 2020 composite:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="country-specific-analyses.html#cb42-1" aria-hidden="true" tabindex="-1"></a>var year <span class="ot">=</span> <span class="dv">2020</span>; <span class="co">#// Year</span></span>
<span id="cb42-2"><a href="country-specific-analyses.html#cb42-2" aria-hidden="true" tabindex="-1"></a>var startDay <span class="ot">=</span> (year)<span class="sc">+</span><span class="st">&#39;-01-01&#39;</span>; <span class="co">#// beginning of date filter | month-day</span></span>
<span id="cb42-3"><a href="country-specific-analyses.html#cb42-3" aria-hidden="true" tabindex="-1"></a>var endDay <span class="ot">=</span> (year)<span class="sc">+</span><span class="st">&#39;-12-30&#39;</span>;   <span class="co">#// end of date filter | month-day</span></span></code></pre></div>
<p>For the spatial parameters, you can use the <em>Large Scale International Boundary (LSIB)</em> dataset and select Guinea’s national border. First, load the dataset into an object <code>countries</code> using the <code>ee.FeatureCollection</code> container and the feature collection ID <code>'USDOS/LSIB/2013'</code>. Secondly, filter the dataset using <code>.filterMetadata</code> and select Guinea from the list of countries and storing it in <code>aoi</code>:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="country-specific-analyses.html#cb43-1" aria-hidden="true" tabindex="-1"></a>var countries <span class="ot">=</span> <span class="fu">ee.FeatureCollection</span>(<span class="st">&#39;USDOS/LSIB/2013&#39;</span>);</span>
<span id="cb43-2"><a href="country-specific-analyses.html#cb43-2" aria-hidden="true" tabindex="-1"></a>var nationalborder <span class="ot">=</span> <span class="fu">countries.filterMetadata</span>(<span class="st">&#39;name&#39;</span> , <span class="st">&#39;equals&#39;</span>, <span class="st">&#39;GUINEA&#39;</span>);</span></code></pre></div>
<div class="rmdcomment">
<p>
Note that you can select a any country border by filtering <em>‘USDOS/LSIB/2013’</em> dataset by using <em>.filterMetadata(‘name’ , ‘equals’, ‘NAME OF THE COUNTRY IN CAPITAL LETTERS’)</em>.
</p>
</div>
<p>Alternatively, you can use any previously uploaded Guinea’s boundary datasets available <a href="https://code.earthengine.google.com/16fbfeb335381c203fed98eb81712dda" target="_blank">here.</a> Select a dataset from the list, copy its Asset ID and load it with <code>ee.FeatureCollection</code> into <code>aoi</code>.</p>
<div class="figure"><span style="display:block;" id="fig:my-borders"></span>
<img src="images/borders.png" alt="Examples of Guinea's administrative borders."  />
<p class="caption">
Figure 5.1: Examples of Guinea’s administrative borders.
</p>
</div>
<p>In this example, we aim to map of Guinea’s mangroves. Therefore, we chose <code>prefecures5k</code> as it emcompasses the entirety of Guinea’s coast:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="country-specific-analyses.html#cb44-1" aria-hidden="true" tabindex="-1"></a>var aoi <span class="ot">=</span> <span class="fu">ee.FeatureCollection</span>(<span class="st">&#39;users/celiohelder/Guinea/Borders/CoastalPrefectures5k&#39;</span>);</span></code></pre></div>
<div class="caution">
<p>
<em><strong>Important</strong></em>: All these datasets were made available through our collaboration with the Guinea and the World Bank and they were modified with a GIS software for the sole purpose of this exercise. You can upload any geographical dataset (both raster or shapefile) into GEE with the <em><strong>NEW</strong></em> button in the Assets table.
</p>
</div>
<p>As auxiliary functions for cloud masking and spectral index calculation, we will use the same functions provided in <a href="auxiliary-functions.html#auxiliary-functions">Chapter 2</a>:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="country-specific-analyses.html#cb45-1" aria-hidden="true" tabindex="-1"></a>var maskL8sr <span class="ot">=</span> <span class="cf">function</span> (image) {</span>
<span id="cb45-2"><a href="country-specific-analyses.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  var cloudShadowBitMask <span class="ot">=</span> <span class="dv">1</span> <span class="sc">&lt;</span><span class="er">&lt;</span> <span class="dv">3</span>;</span>
<span id="cb45-3"><a href="country-specific-analyses.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  var cloudsBitMask <span class="ot">=</span> <span class="dv">1</span> <span class="sc">&lt;</span><span class="er">&lt;</span> <span class="dv">5</span>;</span>
<span id="cb45-4"><a href="country-specific-analyses.html#cb45-4" aria-hidden="true" tabindex="-1"></a>  var qa <span class="ot">=</span> <span class="fu">image.select</span>(<span class="st">&#39;pixel_qa&#39;</span>);</span>
<span id="cb45-5"><a href="country-specific-analyses.html#cb45-5" aria-hidden="true" tabindex="-1"></a>  var mask <span class="ot">=</span> <span class="fu">qa.bitwiseAnd</span>(cloudShadowBitMask)<span class="fu">.eq</span>(<span class="dv">0</span>)</span>
<span id="cb45-6"><a href="country-specific-analyses.html#cb45-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">.and</span>(<span class="fu">qa.bitwiseAnd</span>(cloudsBitMask)<span class="fu">.eq</span>(<span class="dv">0</span>));</span>
<span id="cb45-7"><a href="country-specific-analyses.html#cb45-7" aria-hidden="true" tabindex="-1"></a>  return <span class="fu">image.updateMask</span>(mask)<span class="fu">.divide</span>(<span class="dv">10000</span>)</span>
<span id="cb45-8"><a href="country-specific-analyses.html#cb45-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">.select</span>(<span class="st">&quot;B[0-9]*&quot;</span>)</span>
<span id="cb45-9"><a href="country-specific-analyses.html#cb45-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">.copyProperties</span>(image, [<span class="st">&quot;system:time_start&quot;</span>]);</span>
<span id="cb45-10"><a href="country-specific-analyses.html#cb45-10" aria-hidden="true" tabindex="-1"></a>};</span>
<span id="cb45-11"><a href="country-specific-analyses.html#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="country-specific-analyses.html#cb45-12" aria-hidden="true" tabindex="-1"></a>var addIndicesL8 <span class="ot">=</span> <span class="cf">function</span>(img) {</span>
<span id="cb45-13"><a href="country-specific-analyses.html#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#// NDVI (Normalized Difference Vegetation Index)</span></span>
<span id="cb45-14"><a href="country-specific-analyses.html#cb45-14" aria-hidden="true" tabindex="-1"></a>  var ndvi <span class="ot">=</span> <span class="fu">img.normalizedDifference</span>([<span class="st">&#39;B5&#39;</span>,<span class="st">&#39;B4&#39;</span>])<span class="fu">.rename</span>(<span class="st">&#39;NDVI&#39;</span>);</span>
<span id="cb45-15"><a href="country-specific-analyses.html#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#// NDMI (Normalized Difference Mangrove Index - Shi et al 2016 )</span></span>
<span id="cb45-16"><a href="country-specific-analyses.html#cb45-16" aria-hidden="true" tabindex="-1"></a>  var ndmi <span class="ot">=</span> <span class="fu">img.normalizedDifference</span>([<span class="st">&#39;B7&#39;</span>,<span class="st">&#39;B3&#39;</span>])<span class="fu">.rename</span>(<span class="st">&#39;NDMI&#39;</span>);</span>
<span id="cb45-17"><a href="country-specific-analyses.html#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#// MNDWI (Modified Normalized Difference Water Index - Hanqiu Xu, 2006)</span></span>
<span id="cb45-18"><a href="country-specific-analyses.html#cb45-18" aria-hidden="true" tabindex="-1"></a>  var mndwi <span class="ot">=</span> <span class="fu">img.normalizedDifference</span>([<span class="st">&#39;B3&#39;</span>,<span class="st">&#39;B6&#39;</span>])<span class="fu">.rename</span>(<span class="st">&#39;MNDWI&#39;</span>);</span>
<span id="cb45-19"><a href="country-specific-analyses.html#cb45-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#// SR (Simple Ratio)</span></span>
<span id="cb45-20"><a href="country-specific-analyses.html#cb45-20" aria-hidden="true" tabindex="-1"></a>  var sr <span class="ot">=</span> <span class="fu">img.select</span>(<span class="st">&#39;B5&#39;</span>)<span class="fu">.divide</span>(<span class="fu">img.select</span>(<span class="st">&#39;B4&#39;</span>))<span class="fu">.rename</span>(<span class="st">&#39;SR&#39;</span>);</span>
<span id="cb45-21"><a href="country-specific-analyses.html#cb45-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#// Band Ratio 6/5</span></span>
<span id="cb45-22"><a href="country-specific-analyses.html#cb45-22" aria-hidden="true" tabindex="-1"></a>  var ratio65 <span class="ot">=</span> <span class="fu">img.select</span>(<span class="st">&#39;B6&#39;</span>)<span class="fu">.divide</span>(<span class="fu">img.select</span>(<span class="st">&#39;B5&#39;</span>))<span class="fu">.rename</span>(<span class="st">&#39;R65&#39;</span>);</span>
<span id="cb45-23"><a href="country-specific-analyses.html#cb45-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#// Band Ratio 4/6</span></span>
<span id="cb45-24"><a href="country-specific-analyses.html#cb45-24" aria-hidden="true" tabindex="-1"></a>  var ratio46 <span class="ot">=</span> <span class="fu">img.select</span>(<span class="st">&#39;B4&#39;</span>)<span class="fu">.divide</span>(<span class="fu">img.select</span>(<span class="st">&#39;B6&#39;</span>))<span class="fu">.rename</span>(<span class="st">&#39;R46&#39;</span>);</span>
<span id="cb45-25"><a href="country-specific-analyses.html#cb45-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#// GCVI (Green Chlorophyll Vegetation Index)</span></span>
<span id="cb45-26"><a href="country-specific-analyses.html#cb45-26" aria-hidden="true" tabindex="-1"></a>  var gcvi <span class="ot">=</span> <span class="fu">img.expression</span>(<span class="st">&#39;(NIR/GREEN)-1&#39;</span>,{</span>
<span id="cb45-27"><a href="country-specific-analyses.html#cb45-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;NIR&#39;</span><span class="sc">:</span><span class="fu">img.select</span>(<span class="st">&#39;B5&#39;</span>),</span>
<span id="cb45-28"><a href="country-specific-analyses.html#cb45-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;GREEN&#39;</span><span class="sc">:</span><span class="fu">img.select</span>(<span class="st">&#39;B3&#39;</span>)</span>
<span id="cb45-29"><a href="country-specific-analyses.html#cb45-29" aria-hidden="true" tabindex="-1"></a>  })<span class="fu">.rename</span>(<span class="st">&#39;GCVI&#39;</span>);</span>
<span id="cb45-30"><a href="country-specific-analyses.html#cb45-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-31"><a href="country-specific-analyses.html#cb45-31" aria-hidden="true" tabindex="-1"></a>   return img</span>
<span id="cb45-32"><a href="country-specific-analyses.html#cb45-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.addBands</span>(ndvi) <span class="sc">/</span><span class="er">/</span> This will add each spectral index to each Landsat scene</span>
<span id="cb45-33"><a href="country-specific-analyses.html#cb45-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.addBands</span>(ndmi)</span>
<span id="cb45-34"><a href="country-specific-analyses.html#cb45-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.addBands</span>(mndwi)</span>
<span id="cb45-35"><a href="country-specific-analyses.html#cb45-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.addBands</span>(sr)</span>
<span id="cb45-36"><a href="country-specific-analyses.html#cb45-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.addBands</span>(ratio65)</span>
<span id="cb45-37"><a href="country-specific-analyses.html#cb45-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.addBands</span>(ratio46)</span>
<span id="cb45-38"><a href="country-specific-analyses.html#cb45-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.addBands</span>(gcvi);</span>
<span id="cb45-39"><a href="country-specific-analyses.html#cb45-39" aria-hidden="true" tabindex="-1"></a>};</span></code></pre></div>
<div id="masking" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Masking</h3>
<p>In this example, we will focus on mangrove mapping. Therefore, other known classes can be masked from the analysis.</p>
<ul>
<li><em><strong>Water mask</strong></em></li>
</ul>
<p>The objective of this mask is to remove water pixels from the Landsat composite as we are only focusing on Mangroves. We will create a water mask using the JRC’s Global Surface Water dataset:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="country-specific-analyses.html#cb46-1" aria-hidden="true" tabindex="-1"></a>var globalwater <span class="ot">=</span> <span class="fu">ee.Image</span>(<span class="st">&#39;JRC/GSW1_0/GlobalSurfaceWater&#39;</span>);</span></code></pre></div>
<p>The Global Water Dataset <code>'JRC/GSW1_0/GlobalSurfaceWater'</code> has different bands: one of them <code>'occurrence'</code>. This band shows how many times (expressed as %) a given pixel was classified as water relative to the total time span of the dataset. Let’s isolate the <code>'occurrence'</code> band from the globalwater object:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="country-specific-analyses.html#cb47-1" aria-hidden="true" tabindex="-1"></a>var occurence <span class="ot">=</span> <span class="fu">globalwater.select</span>(<span class="st">&#39;occurrence&#39;</span>); <span class="co">#// Select the occurrence band</span></span></code></pre></div>
<p>Masks are composed by zeros and non-zero values. When you set or apply a mask to an image, the output image will keep its original values where the mask has non-zero values and pixels will be masked where the mask has zeros:</p>
<div class="figure"><span style="display:block;" id="fig:my-mask"></span>
<img src="images/maskexample.png" alt="Masking procedure. In this figure, the mask was applied to the raster image generating an output image where pixels are visible only where the correspondent mask pixel has non-zero values."  />
<p class="caption">
Figure 5.2: Masking procedure. In this figure, the mask was applied to the raster image generating an output image where pixels are visible only where the correspondent mask pixel has non-zero values.
</p>
</div>
<p>For this example, we want to create a water mask. Thus, the water mask has to have zeros where there is water and non-zero values for non-water pixels. Consequently, when we apply this mask to a Landsat image, pixels of water will be invisible (transparent) while all the other pixels will remain visible in the composite. For the mask using the JRC Global Water dataset, make sure you are selecting “permanent” water. One way of doing this is by filtering the dataset for water pixels that occurred more than 50% of the time over the 35 years time spam for this dataset. You can be more or less restrictive with the water extent by changing the 50% threshold.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="country-specific-analyses.html#cb48-1" aria-hidden="true" tabindex="-1"></a>var waterMask <span class="ot">=</span> <span class="fu">occurrence.lt</span>(<span class="dv">50</span>)     <span class="co">#// Selects lower than 50% </span></span>
<span id="cb48-2"><a href="country-specific-analyses.html#cb48-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">.unmask</span>(<span class="dv">1</span>); <span class="co">#// unmkask all other areas and set the values to 1</span></span></code></pre></div>
<p>Note that <code>.lt(50)</code> was used to select pixels from <code>occurrence</code> that are smaller than 50%. Automatically, the values above 50% will be set to 0 which is what is needed for this mask. In this particular case, we use .unmask(1) to set to 1(or unmask) all the other areas that were originally masked in the JRC Global Water dataset.</p>
<div class="figure"><span style="display:block;" id="fig:my-watermask"></span>
<img src="images/watermask.png" alt="Global water mask produced with JRC’s Global Surface Water dataset and Guinea's coastal prefectures (`aoi`) in red for reference. You can add this mask to the map editor (and clip for `aoi`) using *Map.addLayer(waterMask.clip(aoi), {}, 'Water Mask')*. Areas in black (0) will be masked in the composite while areas in white (1) will remain."  />
<p class="caption">
Figure 5.3: Global water mask produced with JRC’s Global Surface Water dataset and Guinea’s coastal prefectures (<code>aoi</code>) in red for reference. You can add this mask to the map editor (and clip for <code>aoi</code>) using <em>Map.addLayer(waterMask.clip(aoi), {}, ‘Water Mask’)</em>. Areas in black (0) will be masked in the composite while areas in white (1) will remain.
</p>
</div>
<ul>
<li><em><strong>Elevation mask</strong></em></li>
</ul>
<p>The purpose of this mask is to further remove pixels that are unlikely to be mangrove based on altitude values. Generally, mangroves will occur near shore where elevation and slope are relatively low. Similar to the water mask, we will create a mask using the SRTM Elevation Data:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="country-specific-analyses.html#cb49-1" aria-hidden="true" tabindex="-1"></a>var srtm <span class="ot">=</span> <span class="fu">ee.Image</span>(<span class="st">&#39;USGS/SRTMGL1_003&#39;</span>);</span></code></pre></div>
<p>Similarly to the previous dataset, select the band of interest by using <code>.select</code>. The altitude values for the SRTM dataset are stored in the elevation band <code>'elevation'</code>. Create a mask <code>elevMask</code> where pixels that have elevation values greater than 25 meters are removed. For that, you select everything that is <em><strong>lower</strong></em> than (<code>.lte</code>) 25 meters; any other value above 25 meters will be set to 0 automatically.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="country-specific-analyses.html#cb50-1" aria-hidden="true" tabindex="-1"></a>var elevation <span class="ot">=</span> <span class="fu">srtm.select</span>(<span class="st">&#39;elevation&#39;</span>);</span>
<span id="cb50-2"><a href="country-specific-analyses.html#cb50-2" aria-hidden="true" tabindex="-1"></a>var elevMask <span class="ot">=</span> <span class="fu">elevation.lte</span>(<span class="dv">25</span>);</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:my-elevmask"></span>
<img src="images/elevmask.PNG" alt="Global elevation (&gt; 25 m) mask produced with the Shuttle Radar Topography Mission dataset and Guinea's coastal prefectures (`aoi`) in red for reference. You can add this mask to the map editor (and clip for `aoi`) using *Map.addLayer(elevMask.clip(aoi), {}, 'Elevation Mask')*. Areas in black (0) will be masked in the composite while areas in white (1) will remain."  />
<p class="caption">
Figure 5.4: Global elevation (&gt; 25 m) mask produced with the Shuttle Radar Topography Mission dataset and Guinea’s coastal prefectures (<code>aoi</code>) in red for reference. You can add this mask to the map editor (and clip for <code>aoi</code>) using <em>Map.addLayer(elevMask.clip(aoi), {}, ‘Elevation Mask’)</em>. Areas in black (0) will be masked in the composite while areas in white (1) will remain.
</p>
</div>
</div>
<div id="landsat-8-image-collection-and-cloud-free-mosaic" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Landsat 8 Image Collection and Cloud-free Mosaic</h3>
<p>Similarly to the examples from <a href="supervised-classification-of-landsat-8-oli-imagery.html#supervised-classification-of-landsat-8-oli-imagery">Chapter 3</a>, load the Landsat 8 Surface Reflectance data archive into an object <code>collection</code> by using the container <code>ee.ImageCollection</code> and the collection ID <code>'LANDSAT/LC08/C01/T1_SR'</code>. Secondly, filter this image collection for the temporal parameters by using the container <code>.filterDate</code>. Finally, map the cloud-masking and spectral indices functions to the collection:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="country-specific-analyses.html#cb51-1" aria-hidden="true" tabindex="-1"></a>var collection <span class="ot">=</span> <span class="fu">ee.ImageCollection</span>(<span class="st">&#39;LANDSAT/LC08/C01/T1_SR&#39;</span>)</span>
<span id="cb51-2"><a href="country-specific-analyses.html#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.filterDate</span>(startDay, endDay)</span>
<span id="cb51-3"><a href="country-specific-analyses.html#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.map</span>(maskL8sr)</span>
<span id="cb51-4"><a href="country-specific-analyses.html#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.map</span>(addIndicesL8);</span></code></pre></div>
<p>In an object called <code>composite</code>, reduce <code>collection</code> using the container <code>.median()</code>. Next, mask the composite using the masks <code>waterMask</code> and <code>elevMask</code> using <code>.mask()</code> for the first mask and then <code>.updateMask()</code> for the second. This container is necessary as we are <em><strong>updating</strong></em> the raster that will have been masked (by the first mask).</p>
<div class="figure"><span style="display:block;" id="fig:my-updatemask"></span>
<img src="images/updatemask.png" alt="Output raster from .`mask()` and `.updateMask()` of a previously masked input raster. `.updateMask()` will only mask areas that have not been masked previously; if `.mask()` is used for a second mask, areas that have been previously invisible (i.e masked) will then assume the values of the mask used."  />
<p class="caption">
Figure 5.5: Output raster from .<code>mask()</code> and <code>.updateMask()</code> of a previously masked input raster. <code>.updateMask()</code> will only mask areas that have not been masked previously; if <code>.mask()</code> is used for a second mask, areas that have been previously invisible (i.e masked) will then assume the values of the mask used.
</p>
</div>
<div class="rmdcomment">
<p>
As a rule of thumb: the <em>first</em> mask applied to the raster is done by <em>.mask()</em> and then use <em>.updateMask()</em> for any subsequent masks.
</p>
</div>
<p>Finally, clip the composite to our area of interest <code>aoi</code> using the container clip:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="country-specific-analyses.html#cb52-1" aria-hidden="true" tabindex="-1"></a>var composite <span class="ot">=</span> collection</span>
<span id="cb52-2"><a href="country-specific-analyses.html#cb52-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">.median</span>()</span>
<span id="cb52-3"><a href="country-specific-analyses.html#cb52-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">.mask</span>(waterMask) <span class="co">#// mask the composite</span></span>
<span id="cb52-4"><a href="country-specific-analyses.html#cb52-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">.updateMask</span>(elevMask) <span class="co">#// update the mask</span></span>
<span id="cb52-5"><a href="country-specific-analyses.html#cb52-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">.clip</span>(aoi);</span></code></pre></div>
<p><img src="images/indent.PNG" /><!-- --></p>
</div>
<div id="supervised-classification-with-random-forest-1" class="section level3" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Supervised Classification with Random Forest</h3>
<ul>
<li><em><strong>Strata for Sample Selection</strong></em></li>
</ul>
<p>As shown in the previous examples, the first step to perform a supervised classification is to select the training samples. One way of selecting the training samples for the Random Forest classifier was shown in the training sample selection section of <a href="supervised-classification-of-landsat-8-oli-imagery.html#supervised-classification-of-landsat-8-oli-imagery">chapter 3</a>. Alternatively, you can automatically select random points based on a stratification map using <code>.stratifiedSample</code>. In this case, the stratification map will have two classes: Mangroves and Non-mangroves.
You can create a mangrove stratum for sample selection using available mangrove datasets, such as:</p>
<ul>
<li>Global Mangrove Forest Distribution dataset (raster) for the year 2000, available through Google Earth Engine (<code>ee.ImageCollection('LANDSAT/MANGROVE_FORESTS')</code>), or;</li>
<li>The latest global Mangrove Extent from the <a href="https://www.globalmangrovewatch.org/country/GIN?map=eyJiYXNlbWFwIjoibGlnaHQiLCJ2aWV3cG9ydCI6eyJsYXRpdHVkZSI6OS45NDcyMTU4OTUwNDI0NzIsImxvbmdpdHVkZSI6LTE1Ljk0Njk3MjgyMzgwNzMzOCwiem9vbSI6Ni4xMzk0MjcyMjU1NDAzMjcsImJlYXJpbmciOjAsInBpdGNoIjowfX0%3D" target="_blank">Global Mangrove Watch</a>, available for download <a href="https://data.unep-wcmc.org/datasets/45" target="_blank">here.</a></li>
<li>Or any other dataset that you may have available;</li>
</ul>
<ol style="list-style-type: lower-alpha">
<li><em>Mangroves</em>: For this example, we will use the GMW Global mangrove extent dataset that was previously downloaded and added as an asset to Google Earth Engine. First, load the mangrove extent shapefile into a object <code>dataset</code>:</li>
</ol>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="country-specific-analyses.html#cb53-1" aria-hidden="true" tabindex="-1"></a>var dataset <span class="ot">=</span> <span class="fu">ee.FeatureCollection</span>(<span class="st">&#39;users/celiohelder/Guinea/Mangroves2016&#39;</span>);</span></code></pre></div>
<p>To create the mangrove stratification class, simply create an image with <code>ee.Image(1)</code> and clip it using <code>dataset</code>:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="country-specific-analyses.html#cb54-1" aria-hidden="true" tabindex="-1"></a>var mangrove <span class="ot">=</span> <span class="fu">ee.Image</span>(<span class="dv">1</span>)<span class="fu">.clip</span>(dataset);</span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li><em>Non-mangroves</em>: Using <code>.where</code>, create an image of zeros where two (2) will be added where there is a pixel from the <code>composite</code>:</li>
</ol>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="country-specific-analyses.html#cb55-1" aria-hidden="true" tabindex="-1"></a>var nonmangrove <span class="ot">=</span> <span class="fu">ee.Image</span>(<span class="dv">0</span>)<span class="fu">.where</span>(<span class="fu">composite.select</span>(<span class="st">&#39;B1&#39;</span>),<span class="dv">2</span>)<span class="fu">.selfMask</span>() </span>
<span id="cb55-2"><a href="country-specific-analyses.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co">#// use selfMask() to eliminate mask itselt and eliminate the zeros</span></span></code></pre></div>
<p>Finally, to create <code>strata</code>, set this image’s pixels to 1 where there is pixels of the mangrove stratum and use <code>.rename</code> to rename it to <code>'landcover</code>.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="country-specific-analyses.html#cb56-1" aria-hidden="true" tabindex="-1"></a>var strata <span class="ot">=</span> <span class="fu">nonmangrove.where</span>(mangrove,<span class="dv">1</span>)<span class="fu">.rename</span>(<span class="st">&#39;landcover&#39;</span>);</span></code></pre></div>
<p>The object <code>strata</code> is an image with one band called <code>'landcover'</code>. It is good practice to rename this band to something easy to remember because <code>.stratifiedSample</code> requires the image and the band name with which the samples will be stratified.</p>
<p>Add <code>strata</code> to the map editor to visualize:</p>
<<<<<<< HEAD
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Map.addLayer</span> (strata, {palette<span class="op">:</span>[<span class="st">&#39;#B3E283&#39;</span>,<span class="st">&#39;#E8E46E&#39;</span>], min<span class="op">:</span><span class="dv">1</span>, max<span class="op">:</span><span class="dv">2</span>}, <span class="st">&#39;Strata&#39;</span>)</code></pre></div>
<div class="figure"><span id="fig:my-strata"></span>
<img src="images/strata.png" alt="Stratification map `strata` showing Global Mangrove Watch's 2016 Mangrove extent (`landcover:1`) and non-mangrove areas (`landcover:2`). The `.stratifiedSample` function generates a set of random points to each of these classes." width="886" />
<p class="caption">
Figure 5.6: Stratification map <code>strata</code> showing Global Mangrove Watch's 2016 Mangrove extent (<code>landcover:1</code>) and non-mangrove areas (<code>landcover:2</code>). The <code>.stratifiedSample</code> function generates a set of random points to each of these classes.
=======
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="country-specific-analyses.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Map.addLayer</span> (strata, {palette<span class="sc">:</span>[<span class="st">&#39;#B3E283&#39;</span>,<span class="st">&#39;#E8E46E&#39;</span>], min<span class="sc">:</span><span class="dv">1</span>, max<span class="sc">:</span><span class="dv">2</span>}, <span class="st">&#39;Strata&#39;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:my-strata"></span>
<img src="images/strata.png" alt="Stratification map `strata` showing Global Mangrove Watch's 2016 Mangrove extent (`landcover:1`) and non-mangrove areas (`landcover:2`). The `.stratifiedSample` function generates a set of random points to each of these classes."  />
<p class="caption">
Figure 5.6: Stratification map <code>strata</code> showing Global Mangrove Watch’s 2016 Mangrove extent (<code>landcover:1</code>) and non-mangrove areas (<code>landcover:2</code>). The <code>.stratifiedSample</code> function generates a set of random points to each of these classes.
>>>>>>> 225ed6b925ba03622f5cf4626388f7519024a900
</p>
</div>
<ul>
<li><em><strong>Random training sample selection</strong></em></li>
</ul>
<p>Now that you have the stratification map <code>strata</code> for mangroves and all other areas, use <code>.stratifiedSample</code> function below to select 1000 points (<code>classPoints</code>) for each of the two classes (<code>classValues</code>):</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="country-specific-analyses.html#cb58-1" aria-hidden="true" tabindex="-1"></a>var stratified <span class="ot">=</span> <span class="fu">strata.addBands</span>(<span class="fu">ee.Image.pixelLonLat</span>())<span class="fu">.stratifiedSample</span>({</span>
<span id="cb58-2"><a href="country-specific-analyses.html#cb58-2" aria-hidden="true" tabindex="-1"></a>      numPoints<span class="sc">:</span> <span class="dv">1</span>,</span>
<span id="cb58-3"><a href="country-specific-analyses.html#cb58-3" aria-hidden="true" tabindex="-1"></a>      classBand<span class="sc">:</span> <span class="st">&#39;landcover&#39;</span>,</span>
<span id="cb58-4"><a href="country-specific-analyses.html#cb58-4" aria-hidden="true" tabindex="-1"></a>      scale<span class="sc">:</span> <span class="dv">30</span>,</span>
<span id="cb58-5"><a href="country-specific-analyses.html#cb58-5" aria-hidden="true" tabindex="-1"></a>      region<span class="sc">:</span> coastalprefectures,</span>
<span id="cb58-6"><a href="country-specific-analyses.html#cb58-6" aria-hidden="true" tabindex="-1"></a>      classValues<span class="sc">:</span>[<span class="dv">1</span>,<span class="dv">2</span>],       <span class="co">#// The classes from strata that points will be selected from</span></span>
<span id="cb58-7"><a href="country-specific-analyses.html#cb58-7" aria-hidden="true" tabindex="-1"></a>      classPoints<span class="sc">:</span>[<span class="dv">1000</span>,<span class="dv">1000</span>]  <span class="co">#// number of points per class. </span></span>
<span id="cb58-8"><a href="country-specific-analyses.html#cb58-8" aria-hidden="true" tabindex="-1"></a>    })<span class="fu">.map</span>(<span class="cf">function</span>(f) {       <span class="co">#// set these points to geometry and get their coordinates</span></span>
<span id="cb58-9"><a href="country-specific-analyses.html#cb58-9" aria-hidden="true" tabindex="-1"></a>       return <span class="fu">f.setGeometry</span>(<span class="fu">ee.Geometry.Point</span>([<span class="fu">f.get</span>(<span class="st">&#39;longitude&#39;</span>), <span class="fu">f.get</span>(<span class="st">&#39;latitude&#39;</span>)]))</span>
<span id="cb58-10"><a href="country-specific-analyses.html#cb58-10" aria-hidden="true" tabindex="-1"></a>    });</span></code></pre></div>
<p>The function above includes:</p>
<ol style="list-style-type: lower-alpha">
<li><code>.addBands(ee.Image.pixelLonLat())</code> to add a band to <code>strata</code> that will have the latitude and longitude for each pixel;</li>
<li><code>numPoints</code> is the default number of points to sample in each class in <code>strata</code>. If <code>numPoints</code> is set to 2000, 1000 points will be selected for each of the two classes in <code>strata</code>. This, however, can be overridden for specific classes using the <code>classValues</code> and <code>classPoints</code> properties. In this case, these properties allow which classes you want to use from your stratification map and how many points for each of these classes you want to select.</li>
<li><code>classBand: 'landcover'</code> to define the band from <code>strata</code> that will be used to select the random samples;</li>
<li><code>scale</code> sets the scale to 30 meters to match Landsat nominal spatial resolution;</li>
<li>The rest of the function will set these points to geometry and get their lat/long coordinates.</li>
</ol>
<p>You can use the function below to colorize these point samples based on a color palette for visualization. First, the color pallete for this particular case will be slightly different that the color palettes that have been used throught this tutorial so far: it will be created as a <code>ee.List</code> of colors including a null color:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="country-specific-analyses.html#cb59-1" aria-hidden="true" tabindex="-1"></a>var paletteSamples <span class="ot">=</span> <span class="fu">ee.List</span>([</span>
<span id="cb59-2"><a href="country-specific-analyses.html#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;FFFFFF&#39;</span>,  <span class="co">#// NULL</span></span>
<span id="cb59-3"><a href="country-specific-analyses.html#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;01937C&#39;</span>,  <span class="co">#// Mangrove</span></span>
<span id="cb59-4"><a href="country-specific-analyses.html#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;B6C867&#39;</span>,  <span class="co">#// Non-Mangrove</span></span>
<span id="cb59-5"><a href="country-specific-analyses.html#cb59-5" aria-hidden="true" tabindex="-1"></a> ]);</span></code></pre></div>
<p>Then, <code>features</code> will include the colorized version of <code>stratified</code> based on the function:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="country-specific-analyses.html#cb60-1" aria-hidden="true" tabindex="-1"></a>var features <span class="ot">=</span> <span class="fu">stratified.map</span>(<span class="cf">function</span>(f) {</span>
<span id="cb60-2"><a href="country-specific-analyses.html#cb60-2" aria-hidden="true" tabindex="-1"></a>  var landcover <span class="ot">=</span> <span class="fu">f.get</span>(<span class="st">&#39;landcover&#39;</span>);</span>
<span id="cb60-3"><a href="country-specific-analyses.html#cb60-3" aria-hidden="true" tabindex="-1"></a>  return <span class="fu">ee.Feature</span>(<span class="fu">ee.Geometry.Point</span>([<span class="fu">f.get</span>(<span class="st">&#39;longitude&#39;</span>), <span class="fu">f.get</span>(<span class="st">&#39;latitude&#39;</span>)]), <span class="fu">f.toDictionary</span>())<span class="fu">.set</span>({style<span class="sc">:</span> {color<span class="sc">:</span> <span class="fu">paletteSamples.get</span>(landcover) }}); </span>
<span id="cb60-4"><a href="country-specific-analyses.html#cb60-4" aria-hidden="true" tabindex="-1"></a>});</span></code></pre></div>
<p>Add <code>features</code> to the map editor using <code>Map.addLayer</code> and <code>.style</code> following the formula below:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="country-specific-analyses.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Map.addLayer</span>(<span class="fu">features.style</span>({styleProperty<span class="sc">:</span> <span class="st">&quot;style&quot;</span>}),{}, <span class="st">&#39;Samples/Location&#39;</span>);</span></code></pre></div>
<p>Remember, these steps are not necessary to the classification workflow. However, it allows you to visualize the selected samples with a color palette of your choice.</p>
<div class="figure"><span style="display:block;" id="fig:my-stratatification"></span>
<img src="images/StratifiedSampleGuinea.PNG" alt="Stratified random samples. The `.stratifiedSample` function generates a set of random points to each of these strata."  />
<p class="caption">
Figure 5.7: Stratified random samples. The <code>.stratifiedSample</code> function generates a set of random points to each of these strata.
</p>
</div>
<ul>
<li><em><strong>Classification</strong></em></li>
</ul>
<p>As seen in previous chapters, we first select the predictors to assign to each sample point in the sample set. For this example, let’s create an object <code>var bands</code> with three spectral bands (<code>'B5'</code>,<code>'B6'</code>,<code>'B7'</code>) and four spectral indices (<code>'NDVI'</code>,<code>'MNDWI'</code>,<code>'SR'</code>).</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="country-specific-analyses.html#cb62-1" aria-hidden="true" tabindex="-1"></a>var bands <span class="ot">=</span> [<span class="st">&#39;B5&#39;</span>,<span class="st">&#39;B6&#39;</span>,<span class="st">&#39;B7&#39;</span>,<span class="st">&#39;NDVI&#39;</span>,<span class="st">&#39;MNDWI&#39;</span>,<span class="st">&#39;SR&#39;</span>];</span></code></pre></div>
<p>In this example, we will create two mangrove extent maps using two sets of samples: <code>samplesAutomatic</code>, which will include the points automatically created with <code>stratified</code> and <code>samplesManual</code>. To create <code>manualpoints</code>, use the same geometry drawing process described in <a href="supervised-classification-of-landsat-8-oli-imagery.html#supervised-classification-of-landsat-8-oli-imagery">chapter 3</a>. Draw the geometries <code>MangroveTraining</code> and <code>NonMangroveTraining</code> and use <code>.merge</code> to create <code>manualpoints</code>.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="country-specific-analyses.html#cb63-1" aria-hidden="true" tabindex="-1"></a>var manualpoints <span class="ot">=</span> <span class="fu">MangroveTraining.merge</span>(NonMangroveTraining);</span></code></pre></div>
<p>Create the <code>samplesAutomatic</code> and <code>samplesManual</code> training sets by overlaying <code>stratified</code> and <code>manualpoints</code> with the Landsat composite to extract the <code>bands</code> predictors using the functions below:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="country-specific-analyses.html#cb64-1" aria-hidden="true" tabindex="-1"></a>var samplesAutomatic <span class="ot">=</span> <span class="fu">composite.select</span>(bands)<span class="fu">.sampleRegions</span>({</span>
<span id="cb64-2"><a href="country-specific-analyses.html#cb64-2" aria-hidden="true" tabindex="-1"></a>  collection<span class="sc">:</span> stratified,   <span class="sc">/</span><span class="er">/</span> Automatically created sample points</span>
<span id="cb64-3"><a href="country-specific-analyses.html#cb64-3" aria-hidden="true" tabindex="-1"></a>  properties<span class="sc">:</span> [<span class="st">&#39;landcover&#39;</span>],</span>
<span id="cb64-4"><a href="country-specific-analyses.html#cb64-4" aria-hidden="true" tabindex="-1"></a>  scale<span class="sc">:</span> <span class="dv">30</span>,</span>
<span id="cb64-5"><a href="country-specific-analyses.html#cb64-5" aria-hidden="true" tabindex="-1"></a>  geometries<span class="sc">:</span> true,</span>
<span id="cb64-6"><a href="country-specific-analyses.html#cb64-6" aria-hidden="true" tabindex="-1"></a>});</span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="country-specific-analyses.html#cb65-1" aria-hidden="true" tabindex="-1"></a>var samplesManual <span class="ot">=</span> <span class="fu">composite.select</span>(bands)<span class="fu">.sampleRegions</span>({</span>
<span id="cb65-2"><a href="country-specific-analyses.html#cb65-2" aria-hidden="true" tabindex="-1"></a>  collection<span class="sc">:</span> manualpoints,       <span class="sc">/</span><span class="er">/</span> Manually selected geometries</span>
<span id="cb65-3"><a href="country-specific-analyses.html#cb65-3" aria-hidden="true" tabindex="-1"></a>  properties<span class="sc">:</span> [<span class="st">&#39;landcover&#39;</span>], </span>
<span id="cb65-4"><a href="country-specific-analyses.html#cb65-4" aria-hidden="true" tabindex="-1"></a>  scale<span class="sc">:</span> <span class="dv">30</span>,</span>
<span id="cb65-5"><a href="country-specific-analyses.html#cb65-5" aria-hidden="true" tabindex="-1"></a>  geometries<span class="sc">:</span> true,</span>
<span id="cb65-6"><a href="country-specific-analyses.html#cb65-6" aria-hidden="true" tabindex="-1"></a>});</span></code></pre></div>
<p>A third sample set (<code>groundtruth</code>) will be used to illusrate a validation process for both mangrove extent maps. First, load a pre-selected set of samples using <code>ee.FeatureCollection</code> then create <code>samplesgroundtruth</code> similarly to the previous two set of samples:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="country-specific-analyses.html#cb66-1" aria-hidden="true" tabindex="-1"></a>var groundtruth <span class="ot">=</span> <span class="fu">ee.FeatureCollection</span>(<span class="st">&#39;users/celiohelder/TutorialAssets/GroundTruth&#39;</span>);</span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="country-specific-analyses.html#cb67-1" aria-hidden="true" tabindex="-1"></a>var samplesgroundtruth <span class="ot">=</span> <span class="fu">composite.select</span>(bands)<span class="fu">.sampleRegions</span>({</span>
<span id="cb67-2"><a href="country-specific-analyses.html#cb67-2" aria-hidden="true" tabindex="-1"></a>  collection<span class="sc">:</span> groundtruth,       <span class="sc">/</span><span class="er">/</span> Set of geometries pre<span class="sc">-</span>selected</span>
<span id="cb67-3"><a href="country-specific-analyses.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  properties<span class="sc">:</span> [<span class="st">&#39;landcover&#39;</span>],</span>
<span id="cb67-4"><a href="country-specific-analyses.html#cb67-4" aria-hidden="true" tabindex="-1"></a>  scale<span class="sc">:</span> <span class="dv">30</span>,</span>
<span id="cb67-5"><a href="country-specific-analyses.html#cb67-5" aria-hidden="true" tabindex="-1"></a>  geometries<span class="sc">:</span> true,</span>
<span id="cb67-6"><a href="country-specific-analyses.html#cb67-6" aria-hidden="true" tabindex="-1"></a>});</span></code></pre></div>
<p>Next, train two Random Forest classifiers using both <code>samplesAutomatic</code> and <code>samplesManual</code> training samples. In this example, we will use 200 trees and 5 predictors tested at each tree node:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="country-specific-analyses.html#cb68-1" aria-hidden="true" tabindex="-1"></a>var RandomForest1 <span class="ot">=</span> <span class="fu">ee.Classifier.smileRandomForest</span>(<span class="dv">200</span>,<span class="dv">5</span>)<span class="fu">.train</span>({</span>
<span id="cb68-2"><a href="country-specific-analyses.html#cb68-2" aria-hidden="true" tabindex="-1"></a>  features<span class="sc">:</span> samplesAutomatic, </span>
<span id="cb68-3"><a href="country-specific-analyses.html#cb68-3" aria-hidden="true" tabindex="-1"></a>  classProperty<span class="sc">:</span> <span class="st">&#39;landcover&#39;</span>, </span>
<span id="cb68-4"><a href="country-specific-analyses.html#cb68-4" aria-hidden="true" tabindex="-1"></a>  inputProperties<span class="sc">:</span> bands</span>
<span id="cb68-5"><a href="country-specific-analyses.html#cb68-5" aria-hidden="true" tabindex="-1"></a>});</span>
<span id="cb68-6"><a href="country-specific-analyses.html#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="country-specific-analyses.html#cb68-7" aria-hidden="true" tabindex="-1"></a>var RandomForest2 <span class="ot">=</span> <span class="fu">ee.Classifier.smileRandomForest</span>(<span class="dv">200</span>,<span class="dv">5</span>)<span class="fu">.train</span>({</span>
<span id="cb68-8"><a href="country-specific-analyses.html#cb68-8" aria-hidden="true" tabindex="-1"></a>  features<span class="sc">:</span> samplesManual, </span>
<span id="cb68-9"><a href="country-specific-analyses.html#cb68-9" aria-hidden="true" tabindex="-1"></a>  classProperty<span class="sc">:</span> <span class="st">&#39;landcover&#39;</span>, </span>
<span id="cb68-10"><a href="country-specific-analyses.html#cb68-10" aria-hidden="true" tabindex="-1"></a>  inputProperties<span class="sc">:</span> bands</span>
<span id="cb68-11"><a href="country-specific-analyses.html#cb68-11" aria-hidden="true" tabindex="-1"></a>});</span></code></pre></div>
<p>Finally, classify the <code>composite</code> into two mangrove extent maps using the trained classifiers and add the outputs to the map editor using a color palette of your choice:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="country-specific-analyses.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span> Classify the Landsat <span class="dv">8</span> Composite using the two classifiers to produce <span class="dv">2</span> land cover maps</span>
<span id="cb69-2"><a href="country-specific-analyses.html#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="country-specific-analyses.html#cb69-3" aria-hidden="true" tabindex="-1"></a>var classifiedrf1 <span class="ot">=</span> <span class="fu">composite.select</span>(bands)           <span class="sc">/</span><span class="er">/</span> select the predictors</span>
<span id="cb69-4"><a href="country-specific-analyses.html#cb69-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">.classify</span>(RandomForest1); <span class="sc">/</span><span class="er">/</span> apply the Random Forest trained with the automatically selected samples</span>
<span id="cb69-5"><a href="country-specific-analyses.html#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="country-specific-analyses.html#cb69-6" aria-hidden="true" tabindex="-1"></a>var classifiedrf2 <span class="ot">=</span> <span class="fu">composite.select</span>(bands)           <span class="sc">/</span><span class="er">/</span> select the predictors</span>
<span id="cb69-7"><a href="country-specific-analyses.html#cb69-7" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">.classify</span>(RandomForest2); <span class="sc">/</span><span class="er">/</span> apply the Random Forest classifier trained with mannually selected samples</span>
<span id="cb69-8"><a href="country-specific-analyses.html#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="country-specific-analyses.html#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span> Color palette <span class="cf">for</span> the classification outputs</span>
<span id="cb69-10"><a href="country-specific-analyses.html#cb69-10" aria-hidden="true" tabindex="-1"></a>var paletteMAP <span class="ot">=</span> [</span>
<span id="cb69-11"><a href="country-specific-analyses.html#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;01937C&#39;</span>, <span class="sc">/</span><span class="er">/</span> Mangrove</span>
<span id="cb69-12"><a href="country-specific-analyses.html#cb69-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;B6C867&#39;</span>, <span class="sc">/</span><span class="er">/</span> Non<span class="sc">-</span>Mangrove</span>
<span id="cb69-13"><a href="country-specific-analyses.html#cb69-13" aria-hidden="true" tabindex="-1"></a>];</span>
<span id="cb69-14"><a href="country-specific-analyses.html#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-15"><a href="country-specific-analyses.html#cb69-15" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span> Add the classifications to the map editor</span>
<span id="cb69-16"><a href="country-specific-analyses.html#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="fu">Map.addLayer</span> (classifiedrf1, {min<span class="sc">:</span> <span class="dv">1</span>, max<span class="sc">:</span> <span class="dv">2</span>, palette<span class="sc">:</span>paletteMAP}, <span class="st">&#39;Classification Automatic Samples&#39;</span>);</span>
<span id="cb69-17"><a href="country-specific-analyses.html#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="fu">Map.addLayer</span> (classifiedrf2, {min<span class="sc">:</span> <span class="dv">1</span>, max<span class="sc">:</span> <span class="dv">2</span>, palette<span class="sc">:</span>paletteMAP}, <span class="st">&#39;Classification Manual Samples&#39;</span>);</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:my-classficationmangrove"></span>
<img src="images/classoutput.png" alt="Random forest classification outputs. Each map was produced using two different set of samples."  />
<p class="caption">
Figure 5.8: Random forest classification outputs. Each map was produced using two different set of samples.
</p>
</div>
<ul>
<li><em><strong>Validation</strong></em></li>
</ul>
<p>For the validation of the two mangrove extent maps we will use <code>.classify</code> and <code>.errorMatrix</code>. <code>.classify</code> will classify the ground truth samples with the trained random forest classifiers 1 and 2; <code>.errorMatrix</code> will compare the result of this classification with their own class label:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="country-specific-analyses.html#cb70-1" aria-hidden="true" tabindex="-1"></a>var validation1 <span class="ot">=</span> <span class="fu">samplesgroundtruth.classify</span>(RandomForest1);</span>
<span id="cb70-2"><a href="country-specific-analyses.html#cb70-2" aria-hidden="true" tabindex="-1"></a>var validation2 <span class="ot">=</span> <span class="fu">samplesgroundtruth.classify</span>(RandomForest2);</span>
<span id="cb70-3"><a href="country-specific-analyses.html#cb70-3" aria-hidden="true" tabindex="-1"></a>var testAccuracy1 <span class="ot">=</span> <span class="fu">validation1.errorMatrix</span>(<span class="st">&#39;landcover&#39;</span>, <span class="st">&#39;classification&#39;</span>);</span>
<span id="cb70-4"><a href="country-specific-analyses.html#cb70-4" aria-hidden="true" tabindex="-1"></a>var testAccuracy2 <span class="ot">=</span> <span class="fu">validation2.errorMatrix</span>(<span class="st">&#39;landcover&#39;</span>, <span class="st">&#39;classification&#39;</span>);</span></code></pre></div>
<p>You can print the error matrices along with the overall accuracy and Kappa values to the console using <code>.accuracy()</code> and <code>kappa()</code>:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="country-specific-analyses.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Overall Accuracy Map 1: &#39;</span>, <span class="fu">testAccuracy1.accuracy</span>());</span>
<span id="cb71-2"><a href="country-specific-analyses.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Overall Accuracy Map 2: &#39;</span>, <span class="fu">testAccuracy2.accuracy</span>());</span>
<span id="cb71-3"><a href="country-specific-analyses.html#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Kappa: &#39;</span>, <span class="fu">testAccuracy1.kappa</span>());</span>
<span id="cb71-4"><a href="country-specific-analyses.html#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Kappa: &#39;</span>, <span class="fu">testAccuracy2.kappa</span>());</span>
<span id="cb71-5"><a href="country-specific-analyses.html#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Validation error matrix Map1: &#39;</span>, testAccuracy1);</span>
<span id="cb71-6"><a href="country-specific-analyses.html#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Validation error matrix Map2: &#39;</span>, testAccuracy2);</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:my-results"></span>
<img src="images/ResultsGuinea.PNG" alt="Validation results for this example. Ground truth data (in this context it refers to independent samples) were used to calculate the overall accuracy and kappa values."  />
<p class="caption">
Figure 5.9: Validation results for this example. Ground truth data (in this context it refers to independent samples) were used to calculate the overall accuracy and kappa values.
</p>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="post-classification-processing.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/celiosousa/LCMTutorial/edit/master/05-CountrySpecificExamples.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/celiosousa/LCMTutorial/blob/master/05-CountrySpecificExamples.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
