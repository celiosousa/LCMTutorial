[["index.html", "Supervised Classification with Google Earth Engine Chapter 1 Introduction and Overview", " Supervised Classification with Google Earth Engine Celio Sousa 2021-05-03 Chapter 1 Introduction and Overview "],["auxiliary-functions.html", "Chapter 2 Auxiliary functions 2.1 Cloud and cloud shadow masking 2.2 Spectral Indices 2.3 Compositing", " Chapter 2 Auxiliary functions Objective: Here we aim to provide the initial functions and lines of code to assist the user to prepare, process and analyze Landsat 8/7 data for classification purposes. 2.1 Cloud and cloud shadow masking Section Snapshot at GEE This section demonstrates a way of masking clouds and cloud shadow pixels from Landsat 8/7 Surface Reflectance data based on file metadata. This function was created based on the documentation available for Landsat 8/7. Values for pixel bit and pixel band were found here. The cloud masking function is as follows: function maskL8sr(image) { // #Bits 3 and 5 are cloud shadow and cloud, respectively. var cloudShadowBitMask = ee.Number(2).pow(3).int(); var cloudsBitMask = ee.Number(2).pow(5).int(); // #Get the pixel QA band. var qa = image.select(&#39;pixel_qa&#39;); // #Both flags should be set to zero, indicating clear conditions. var mask = qa.bitwiseAnd(cloudShadowBitMask).eq(0) .and(qa.bitwiseAnd(cloudsBitMask).eq(0)); // #Return the masked image, scaled to [0, 1]. return image.updateMask(mask).divide(10000).copyProperties(image, [&quot;system:time_start&quot;]); }; 2.2 Spectral Indices This section demonstrates how to calculate and add spectral indices to each scene of a Landsat 8 image collection. The function below calculates and add spectral indices to an image collection taking into account the Landsat 8 spectral bands and their respective wavelengths: The function used to calculate several commonly used spectral indices follows this format: var addIndicesL8 = function(img) { //# NDVI (Normalized Difference Vegetation Index) var ndvi = img.normalizedDifference([&#39;B5&#39;,&#39;B4&#39;]).rename(&#39;NDVI&#39;); //# NDMI (Normalized Difference Mangrove Index - Shi et al 2016 ) var ndmi = img.normalizedDifference([&#39;B7&#39;,&#39;B3&#39;]).rename(&#39;NDMI&#39;); //# MNDWI (Modified Normalized Difference Water Index - Hanqiu Xu, 2006) var mndwi = img.normalizedDifference([&#39;B3&#39;,&#39;B6&#39;]).rename(&#39;MNDWI&#39;); //# SR (Simple Ratio) var sr = img.select(&#39;B5&#39;).divide(img.select(&#39;B4&#39;)).rename(&#39;SR&#39;); //# Band Ratio 6/5 var ratio65 = img.select(&#39;B6&#39;).divide(img.select(&#39;B5&#39;)).rename(&#39;R65&#39;); //# Band Ratio 4/6 var ratio46 = img.select(&#39;B4&#39;).divide(img.select(&#39;B6&#39;)).rename(&#39;R46&#39;); //# GCVI (Green Chlorophyll Vegetation Index) var gcvi = img.expression(&#39;(NIR/GREEN)-1&#39;,{ &#39;NIR&#39;:img.select(&#39;B5&#39;), &#39;GREEN&#39;:img.select(&#39;B3&#39;) }).rename(&#39;GCVI&#39;); return img .addBands(ndvi) //# The .addBands will add each spectral index to each Landsat scene .addBands(ndmi) .addBands(mndwi) .addBands(sr) .addBands(ratio65) .addBands(ratio46) .addBands(gcvi); }; Note that the function above shows several ways of doing band math operations. First, normalized difference indices can be calculated using img.normalizedDifference. For more intricate expressions, You can use the expression format as shown with the Green Chlorophyll Vegetation Index example. 2.3 Compositing Section Snapshot at GEE In the previous sections, we learn two useful functions: cloud masking and spectral indices calculation. In this section, we will learn about compositing and mosaicking Landsat scenes. In the next chapter, we will use all three functions covered in here to produce a cloud-free mosaic of Landsat 8 scenes and how to perform a random forest classification. You can composite any object containing an image collection using on a per-pixel, per- band basis using .median() or using quality bands such as NDVI with .qualityMosaic(NDVI). The .median() will composite all the images in the collection to a single image using the median values of each band, at the pixel level; .qualityMosaic(NDVI) will composite all the images in the collection and set each pixel in the composite based on which image in the collection has a maximum value for the specified band, in this case NDVI. Although there are different methods for compositing, the median composite method is the state of the art in Google Earth Engine and it has been widely used in classification and change analysis studies. For instance, it was used in a recent publication of September 2019 mapping cropland extent over southeast and northeast Asia using Landsat 8 and GEE. Median was also the compositing method chosen in this study to showcase GEEs array-based computational approach. The authors of this study mapping land cover change in Namibia also used median composities in their analysis. The same approach was used here to produce a land cover map for the entire Southeast Asia and here to map land cover and land cover change over continental Africa. Additionally, methods such as maximum NDVI would present issues, especially over cloudy areas. As you composite using maximum values of NDVI, water bodies will be completely covered by clouds in the resulting composite as clouds have slightly higher NDVI than water. A second cleaning or compositing procedure would be necessary to avoid this issue over water bodies, which in this case is not ideal. Figure 2.1: Median (left) and Maximum NDVI (Greenest Pixel) (right) composites of Landsat 8 images over Lake Piso in Liberia. Clouds have slightly higher NDVI than water. Therefore, cloudy pixels over water bodies often occur with this compositing method. "],["supervised-classification-of-landsat-8-oli-imagery.html", "Chapter 3 Supervised Classification of Landsat 8 OLI Imagery", " Chapter 3 Supervised Classification of Landsat 8 OLI Imagery Objectives: Use the cloud-masking function (See Chapter 2's Cloud and cloud shadow masking section) to mask clouds on Landsat 8 Imagery; To produce a cloud-free composite mosaic using the median reducer (Compositing), and; To classify the cloud-free composite mosaic of Landsat 8 scenes using Random Forest. "]]
